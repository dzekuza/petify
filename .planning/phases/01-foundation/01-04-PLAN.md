---
phase: 01-foundation
plan: 04
type: execute
wave: 2
depends_on:
  - "01-02"
files_modified:
  - src/components/provider-card.tsx
  - src/components/listings-grid.tsx
autonomous: true
requirements:
  - CLEAN-03
must_haves:
  truths:
    - "A single canonical ProviderCard component exists with variant prop supporting 'grid' and 'horizontal' layouts"
    - "listings-grid.tsx no longer contains inline card JSX — it imports and renders ProviderCard"
    - "The grid variant displays an image-dominant layout with photo taking ~60% of card area (Airbnb-style)"
    - "No-photo fallback shows a pet-themed placeholder icon instead of a broken image or generic gray box"
  artifacts:
    - path: "src/components/provider-card.tsx"
      provides: "Unified ProviderCard with variant prop"
      contains: "variant.*grid.*horizontal"
    - path: "src/components/listings-grid.tsx"
      provides: "Grid layout importing ProviderCard"
      contains: "import.*ProviderCard.*from.*provider-card"
  key_links:
    - from: "src/components/listings-grid.tsx"
      to: "src/components/provider-card.tsx"
      via: "ProviderCard import"
      pattern: "import.*ProviderCard.*from.*provider-card"
    - from: "src/components/provider-card.tsx"
      to: "src/types/index.ts"
      via: "ServiceProvider type import"
      pattern: "import.*ServiceProvider.*from.*@/types"
---

<objective>
Merge the inline card implementation in listings-grid.tsx with provider-card.tsx into a single canonical ProviderCard component with `variant` prop.

Purpose: Eliminate the duplicate card implementations so Phase 4 (Provider Cards) has exactly one component to enhance with image carousel, skeleton loading, hover interactions, and favorites animation.
Output: One ProviderCard with 'grid' (image-dominant) and 'horizontal' (compact list) variants. listings-grid.tsx uses it instead of inline JSX.
</objective>

<execution_context>
@/Users/gvozdovic/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gvozdovic/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@src/components/provider-card.tsx
@src/components/listings-grid.tsx
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign provider-card.tsx as unified ProviderCard with variant prop</name>
  <files>
    src/components/provider-card.tsx
    src/types/index.ts
  </files>
  <action>
    **Rewrite `src/components/provider-card.tsx`** to implement the unified ProviderCard per user decisions:

    **Interface:**
    ```typescript
    import { ServiceProvider, Service } from '@/types'

    interface ProviderCardProps {
      provider: ServiceProvider
      variant?: 'grid' | 'horizontal'  // default: 'grid'
      services?: Service[]
      distance?: number
      className?: string
    }
    ```

    **Grid variant (default) — Image-dominant Airbnb-style:**
    - Image takes ~60% of card height (use aspect-[3/2] or similar) with `object-cover`
    - Below image: provider name (font-semibold), location, star rating + review count, starting price ("from $X"), service category tags
    - Verified badge if provider is verified (use a small checkmark icon from lucide-react)
    - Favorites heart button in top-right corner of image (placeholder — Phase 4 adds animation)
    - Card has rounded corners (`rounded-xl`), subtle border (`border-border`), and overflow-hidden on image

    **No-photo fallback:**
    - When provider has no image/photo, show a warm gradient background (`bg-gradient-to-br from-brand-light to-muted`) with a centered `PawPrint` icon from lucide-react
    - Per user decision: "friendly pet-themed placeholder illustration to keep visual consistency"
    - Do NOT use emoji or generic gray boxes

    **Horizontal variant — Compact list view:**
    - Image on left (~120px wide, square or 4:3), info on right
    - Same data points: name, rating, price, location, service tags
    - Condensed layout for list/search views

    **Both variants use semantic design tokens** (from Plan 02):
    - `text-foreground` for primary text, `text-muted-foreground` for secondary
    - `bg-background` or `bg-card` for card background
    - `border-border` for card border
    - `bg-brand` for accent elements if needed

    **Preserve existing ProviderCard call sites:**
    Read ALL current usages of `<ProviderCard>` in the codebase (`grep -rn "ProviderCard" src/`) and ensure the new component accepts the same props or provides backward compatibility. If old props like `provider` are already passed, the new interface should accept them. Add the `variant` prop as optional with default `'grid'`.

    **Star rating display:**
    - Show as "X.X ★ (N reviews)" format using `text-foreground` for rating, `text-muted-foreground` for review count
    - Use lucide-react `Star` icon filled in amber/yellow

    **Starting price:**
    - Display "From $X" where X is the lowest price from provider's services
    - If no services/prices available, don't show the price line

    **Service tags:**
    - Show as small pills/chips: `bg-secondary text-secondary-foreground rounded-full px-2 py-0.5 text-xs`
    - Limit to 2-3 visible tags, rest hidden
  </action>
  <verify>
    Run `pnpm lint` — no TypeScript errors in provider-card.tsx.
    Inspect the component renders both variants by checking the conditional logic exists.
    Verify the no-photo fallback renders a PawPrint icon: `grep -n "PawPrint" src/components/provider-card.tsx`.
  </verify>
  <done>
    provider-card.tsx exports a single ProviderCard with `variant?: 'grid' | 'horizontal'` prop. Grid variant is image-dominant with 3:2 aspect ratio. Horizontal variant is compact. No-photo fallback uses PawPrint icon in a warm gradient. All text uses semantic tokens.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update listings-grid.tsx to use ProviderCard and fix all call sites</name>
  <files>
    src/components/listings-grid.tsx
    src/components/provider-card.tsx
  </files>
  <action>
    **Step 1 — Remove inline card JSX from listings-grid.tsx:**
    Read the current `listings-grid.tsx` and identify the inline card implementation (research says lines ~100-199). Remove all inline card JSX and replace with:
    ```typescript
    import { ProviderCard } from './provider-card'
    ```
    Then render `<ProviderCard provider={provider} variant="grid" />` in the grid loop instead of the inline JSX.

    **Step 2 — Verify prop mapping:**
    The inline card in listings-grid.tsx may pass data in a different shape than what ProviderCard expects. Check what data the grid passes (it likely passes the raw provider object from the API). Ensure ProviderCard's `provider` prop type (ServiceProvider from src/types/index.ts) matches the shape being passed. If there's a mismatch, add a transform or accept a more flexible type.

    **Step 3 — Check all other ProviderCard call sites:**
    Run `grep -rn "ProviderCard\|provider-card" src/ --include="*.tsx"` and verify every import/usage compiles with the new interface. Common call sites to check:
    - `src/components/listings-grid.tsx` (just updated)
    - `src/components/featured-providers.tsx`
    - `src/components/pagination-provider-cards.tsx`
    - Any search results pages

    For each call site: if they pass props that no longer exist on the new ProviderCard, update them. If they relied on the old card's avatar/action-buttons layout, those are gone — the new image-dominant design replaces it.

    **Step 4 — Run lint and build:**
    `pnpm lint` and `pnpm build` must both pass.
  </action>
  <verify>
    Run `grep -n "inline.*card\|CardContent\|CardHeader" src/components/listings-grid.tsx` — should show no inline card implementation (listings-grid only uses ProviderCard).
    Run `grep -rn "ProviderCard" src/ --include="*.tsx"` — confirm all usages compile.
    Run `pnpm build` — builds successfully.
  </verify>
  <done>
    listings-grid.tsx uses `<ProviderCard variant="grid" />` instead of inline card JSX. All call sites across the codebase compile with the new ProviderCard interface. `pnpm build` passes.
  </done>
</task>

</tasks>

<verification>
1. `grep -c "variant" src/components/provider-card.tsx` confirms variant prop exists
2. `grep -n "ProviderCard" src/components/listings-grid.tsx` shows import and usage
3. No inline card JSX remains in listings-grid.tsx
4. `pnpm build` completes successfully
5. `pnpm lint` passes
</verification>

<success_criteria>
- Single ProviderCard component with 'grid' and 'horizontal' variants
- Grid variant: image-dominant, 3:2 ratio, Airbnb-style layout
- No-photo fallback: PawPrint icon in warm gradient
- listings-grid.tsx imports ProviderCard — no inline card
- All existing call sites compile without errors
- Full details on card: name, rating, review count, price, location, service tags, verified badge
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md`
</output>
