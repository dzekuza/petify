---
phase: 02-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/navigation.tsx
  - src/components/navigation/navigation-header.tsx
  - src/components/navigation/types.ts
autonomous: true
requirements:
  - NAV-01
  - NAV-02

must_haves:
  truths:
    - "The header is transparent (no blur, no border, no shadow) when the page is scrolled to the top"
    - "The header shows backdrop blur, a bottom border, and a subtle shadow when the user scrolls past the top"
    - "The transition between transparent and blurred states is smooth (duration-300)"
    - "Navigation links use semantic brand tokens for active state instead of raw red classes"
    - "The hardcoded grooming sub-service links are removed from the desktop nav"
  artifacts:
    - path: "src/components/navigation.tsx"
      provides: "Scroll detection state (scrolled boolean) passed to NavigationHeader"
      contains: "window.scrollY"
    - path: "src/components/navigation/navigation-header.tsx"
      provides: "Conditional header classes based on scrolled prop"
      contains: "scrolled"
    - path: "src/components/navigation/types.ts"
      provides: "Updated NavigationHeaderProps with scrolled property"
      contains: "scrolled"
  key_links:
    - from: "src/components/navigation.tsx"
      to: "src/components/navigation/navigation-header.tsx"
      via: "scrolled prop"
      pattern: "scrolled={scrolled}"
---

<objective>
Make the header scroll-aware with conditional backdrop blur and clean up navigation typography.

Purpose: The header currently applies `backdrop-blur-xl` unconditionally, creating visual noise on pages with light backgrounds at the top. NAV-01 requires a modern transparent-at-top / frosted-glass-on-scroll pattern. NAV-02 requires removing the hardcoded grooming sub-service links and replacing raw `bg-red-50 text-red-600` active states with semantic brand tokens.

Output: A scroll-responsive header that transitions smoothly between transparent and blurred states, with clean navigation typography using proper brand tokens.
</objective>

<execution_context>
@/Users/gvozdovic/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gvozdovic/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-navigation/02-RESEARCH.md
@src/components/navigation.tsx
@src/components/navigation/navigation-header.tsx
@src/components/navigation/types.ts
@src/components/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scroll detection to Navigation and pass scrolled prop to NavigationHeader</name>
  <files>
    src/components/navigation.tsx
    src/components/navigation/types.ts
  </files>
  <action>
In `src/components/navigation.tsx`:

1. Add a `scrolled` state: `const [scrolled, setScrolled] = useState(false)`

2. Add a `useEffect` for scroll detection. Do NOT merge this with the existing `isMounted` effect — keep them separate for clarity:

```typescript
useEffect(() => {
  const handleScroll = () => setScrolled(window.scrollY > 10)
  handleScroll() // Initialize from current scroll position (fixes hydration flash — see Research Pitfall 3)
  window.addEventListener('scroll', handleScroll, { passive: true })
  return () => window.removeEventListener('scroll', handleScroll)
}, [])
```

The `{ passive: true }` option is critical — it tells the browser the handler will not call `preventDefault()`, so scroll remains on the compositor thread with zero jank.

The `handleScroll()` call on mount (inside useEffect, so client-only) initializes `scrolled` from actual scroll position, preventing a flash if the browser restores scroll position on page reload.

3. Pass `scrolled` to `NavigationHeader`:
```tsx
<NavigationHeader
  scrolled={scrolled}
  // ...existing props unchanged...
/>
```

In `src/components/navigation/types.ts`:

No changes needed here — `NavigationHeaderProps` is defined inline in `navigation-header.tsx`, not in `types.ts`. The `NavigationProps` interface in `types.ts` is for the `Navigation` component itself and does not need changes.
  </action>
  <verify>
Run `npx tsc --noEmit` — no type errors related to navigation files. Verify `scrolled` prop is passed in `navigation.tsx`.
  </verify>
  <done>
`navigation.tsx` has a scroll listener that tracks `window.scrollY > 10`, initializes from current scroll position on mount, and passes `scrolled` boolean to `NavigationHeader`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Make header classes scroll-conditional, clean up typography and active states</name>
  <files>
    src/components/navigation/navigation-header.tsx
  </files>
  <action>
In `src/components/navigation/navigation-header.tsx`:

1. **Update the `NavigationHeaderProps` interface** (defined inline at the top of this file):
   - Add `scrolled: boolean` to the interface
   - Add `scrolled` to the destructured props

2. **Make the `<header>` classes conditional on `scrolled`:**

Replace the current unconditional `backdrop-blur-xl`:
```tsx
<header className="fixed top-0 z-50 w-full backdrop-blur-xl">
```

With conditional classes using `cn()` (already imported):
```tsx
<header
  className={cn(
    "fixed top-0 z-50 w-full transition-all duration-300",
    scrolled
      ? "bg-background/80 backdrop-blur-xl border-b border-border/50 shadow-sm"
      : "bg-transparent"
  )}
>
```

Key details:
- `transition-all duration-300` gives a smooth 300ms crossfade between states
- `bg-background/80` provides 80% opacity background that lets content show through with the blur
- `shadow-sm` adds subtle elevation when scrolled — matches the modern SaaS header pattern
- `bg-transparent` on un-scrolled keeps the header clean on hero sections

3. **Remove the hardcoded grooming sub-service nav links.** Delete the entire `<nav className="hidden md:flex items-center gap-2">` block that contains the 5 hardcoded grooming service types (`simple_bath`, `full_grooming`, `nail_trimming`, `ear_cleaning`, `teeth_cleaning`) AND the Favorites link.

The Favorites link (`<Link href="/favorites">`) should be KEPT but moved outside the deleted `<nav>` block. Place it in the user actions area (the `<div className="flex items-center space-x-4">` near `UserMenu`), before `UserMenu`, visible only on desktop and when not on a provider route:

```tsx
<div className="flex items-center space-x-4">
  {!isProviderRoute && (
    <Link
      href="/favorites"
      className={cn(
        "hidden md:flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all duration-200",
        pathname === '/favorites'
          ? "bg-brand-light text-brand"
          : "text-muted-foreground hover:text-foreground"
      )}
    >
      <Heart className="h-4 w-4" />
      Mėgstami
    </Link>
  )}
  <UserMenu ... />
</div>
```

Notice the active state now uses `bg-brand-light text-brand` (semantic brand tokens from Phase 1) instead of the raw `bg-red-50 text-red-600`.
  </action>
  <verify>
1. Run `npx tsc --noEmit` — no type errors.
2. Run `npm run build` — build succeeds.
3. Visually verify: the header `<header>` element should have `transition-all duration-300` and conditional class application. No hardcoded grooming links remain. No raw `bg-red-50` or `text-red-600` classes exist in the file.
  </verify>
  <done>
The header applies `backdrop-blur-xl`, `bg-background/80`, `border-b border-border/50`, and `shadow-sm` only when scrolled. When at top, it is `bg-transparent`. The hardcoded grooming sub-service links are removed. The Favorites link uses `bg-brand-light text-brand` for its active state. Zero raw red color classes remain in the file.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors in navigation files
2. `npm run build` succeeds
3. In `navigation-header.tsx`: no `bg-red-50`, no `text-red-600`, no hardcoded grooming service type links
4. In `navigation-header.tsx`: `scrolled` prop controls header background/blur/border classes
5. In `navigation.tsx`: scroll listener with `{ passive: true }` and initial position check exists
</verification>

<success_criteria>
- Header renders transparent (no blur, no border) when scrollY <= 10
- Header renders with backdrop-blur, border, and shadow when scrollY > 10
- Transition between states is animated with duration-300
- No hardcoded grooming sub-service links exist in the desktop nav
- Favorites link active state uses `bg-brand-light text-brand` tokens
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-navigation/02-01-SUMMARY.md`
</output>
